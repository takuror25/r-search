<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>【非公式】れいわ街宣・おしゃべり会全文検索</title>
<style>
body { font-family: sans-serif; max-width: 800px; margin: auto; padding: 1em; }
a { text-decoration: none; color: #0366d6; }
.highlight { background: yellow; }
</style>
</head>
<body>

<h1>【非公式】れいわ街宣・おしゃべり会全文検索</h1>

<input id="search" type="text" placeholder="キーワード検索（例：消費税）" style="width:100%; padding:0.5em; margin-bottom:1em;">

<h2>各回の一覧</h2>
<ul id="list">
  <li><a href="talks/2025-09-03-wakkanai.html">2025-09-03 稚内</a></li>
  <li><a href="talks/2025-09-06-iwamisawa.html">2025-09-06 岩見沢</a></li>
  <li><a href="talks/2025-09-06-chitose.html">2025-10-01 千歳</a></li>
</ul>

<hr>

<div id="results"></div>

<script>
// 各ページのメタ情報
const pages = [
  { title: "2025-09-03 稚内", url: "talks/2025-09-03-wakkanai.html" },
  { title: "2025-09-06 岩見沢", url: "talks/2025-09-06-iwamisawa.html" },
  { title: "2025-09-06 千歳", url: "talks/2025-09-06-chitose.html" }
];

const input = document.getElementById('search');
const results = document.getElementById('results');

// 全ページを先に読み込んでメモリに保存
const docs = [];
Promise.all(pages.map(p => 
  fetch(p.url).then(r => r.text()).then(t => {
    docs.push({ title: p.title, url: p.url, text: t });
  })
)).then(() => {
  console.log("All pages loaded.");
});

input.addEventListener('input', () => {
  const q = input.value.trim();
  results.innerHTML = '';
  if (!q) return;

  const regex = new RegExp(q, 'gi');
  docs.forEach(d => {
    if (d.text.match(regex)) {
      const snippet = d.text.replace(regex, m => `<span class="highlight">${m}</span>`).slice(0, 500) + "...";
      const div = document.createElement('div');
      div.innerHTML = `<h3><a href="${d.url}" target="_blank">${d.title}</a></h3><p>${snippet}</p><hr>`;
      results.appendChild(div);
    }
  });
});
</script>

</body>
</html>
